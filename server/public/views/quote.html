<html>

<head>
  <title>Insubuy coding challenge</title>
  <link rel="stylesheet" href="/stylesheets/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:200,400,700">
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
  <script src="https://unpkg.com/vuejs-datepicker"></script>
  <script src="/js/libraries/validator.min.js"></script>
  <script src="/js/libraries/datepicker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</head>


<style>
    
</style>

<body>
    <div class="container">

        <div class="panel">
            <div class="panel-header light-blue-bg clearfix">
                <img class="panel-logo" src="/images/logo.png">
                <div class="panel-title">
                    Travel Insurance
                </div>
            </div>

            <div class="panel-body">
                <form id="quote-form">
                    <div class="alert alert-error column-sm-50" v-if="errorMessage" >
                        <h4 class="no-margin margin-bottom-md">Form Could Not Be Submitted</h4>
                        <div v-html="errorMessage"></div>
                    </div>

                    <div class="clearfix">
                        <div class="element-wrapper column-sm-50 clearfix">
                            <div class="column-xs-50 column-full">
                                <label>Start Date</label>
                                <vuejs-datepicker v-model="start_date" @input="startDateChanged" input-class="form-element date" editable="true" name="start_date" format="MM/dd/yyyy" :typeable=true></vuejs-datepicker>
                            </div>
                            
                            <div class="column-xs-50 column-full">
                                <label>End Date</label>
                                <vuejs-datepicker  v-model="end_date" input-class="form-element date" name="end_date" format="MM/dd/yyyy" :typeable=true></vuejs-datepicker>
                            </div>                        
                        </div>
    
                        <div class="element-wrapper column-sm-50">
                            <label>Policy Max</label>
                            <select class="form-element" name="policy_max" v-model="policy_max">
                                <option value="">Choose a Max</option>
                                <option value="50">50,000</option>
                                <option value="100">100,000</option>
                                <option value="250">250,000</option>
                                <option value="500">500,000</option>
                            </select>
                        </div>
    
                        <div class="element-wrapper column-sm-50">
                            <label>Citizenship</label>
                            <input v-model="citizenship" class="form-element" name="citizenship" />
                        </div>
    
                        <div class="element-wrapper column-sm-50">
                            <label>Age/Year</label>
                            <input v-model="age" class="form-element" name="age" />
                        </div>
    
                        <div class="element-wrapper column-sm-50">
                            <label>Mailing State</label>
                            <input v-model="state" class="form-element" name="state" />
                        </div>
                    </div>

                    <div class="element-wrapper column-xs-100">
                        <input type="button" class="btn btn-submit" v-on:click="submit" value="Submit" />
                        <input type="button" class="btn btn-reset" v-on:click="reset" value="Reset" />
                    </div>
                    
                        <!-- <li>Start Date
                                <br>-User can either type or select a date
                                <br>-The date should be in MM/DD/YYYY format.
                              </li>
                              <br>
                              <li>End Date
                                <br>-User can either type or select a date
                                <br>-The date should be in MM/DD/YYYY format.
                                <br>-The end date should be after the start date.
                              </li>
                              <br>
                              <li>Policy max
                                <br>-Must be a select box
                                <br>- 50,000 ( value 50)
                                <br>- 100,000 ( value 100)
                                <br>- 250,000 ( value 250)
                                <br>- 500,000 ( value 500)
                              </li>
                              <br>
                              <li>Citizenship
                                <br>-Must be a text box
                                <br>-Should not allow numbers or special characters
                              </li>
                              <br>
                              <li>Age/Year
                                <br>-Must be a text box
                                <br>-User can enter either birth year or age
                                <br>-User cannot be more than a 100 years old
                              </li>
                              <br>
                              <li>Mailing State
                                <br>-Must be a text box
                                <br>-Should not allow numbers or special characters
                              </li>
                             -->

                </form>
            </div>
        </div>
    </div>
</body>

<script>
    Date.prototype.mmddyyyy = function() {
        var yyyy = this.getFullYear();
        var mm = this.getMonth() < 9 ? "0" + (this.getMonth() + 1) : (this.getMonth() + 1); // getMonth() is zero-based
        var dd  = this.getDate() < 10 ? "0" + this.getDate() : this.getDate();
        return mm + "/" + dd + "/" + yyyy;
    };
    var form = new Vue({
        el: '#quote-form',
        components: {
            vuejsDatepicker
        },
        data: {
            start_date: null,
            end_date: null,
            policy_max: '',
            citizenship: null,
            age: null,
            state: null,
            errorMessage: null
        },
        created: function () {
            // flatpickr(".date");
        },
        methods: {
            submit: function() {
                this.validate();
            },
            reset: function() {
                this.start_date = null;
                this.end_date = null;
                this.policy_max = '';
                this.citizenship = null;
                this.age = null;
                this.state = null;
                this.errorMessage = null;
            },
            validate: function() {
                var regex = /^[0-9]{2}[\/][0-9]{2}[\/][0-9]{4}$/;
                var errors = {};

                var start_date = '';
                if(this.start_date instanceof Date)
                    start_date = this.start_date.mmddyyyy();

                if(validator.isEmpty(start_date))
                    errors['start_date'] = "<li>Start Date cannot be empty</li>";
                else if(!validator.matches(start_date, regex)) {
                    errors['start_date'] = "<li>Start Date must match MM/DD/YYYY</li>";
                }                

                var end_date = '';
                if(this.end_date instanceof Date)
                    end_date = this.end_date.mmddyyyy();

                if(validator.isEmpty(end_date))
                    errors['end_date'] = "<li>End Date cannot be empty</li>";
                else if(!validator.matches(end_date, regex)) {
                    errors['end_date'] = "<li>End Date must match MM/DD/YYYY</li>";
                } else if(this.end_date <= this.start_date) {
                    errors['end_date'] = "<li>End Date must be after Start Date";
                }

                this.errorMessage = '';
                for(var key in errors) {
                    this.errorMessage += errors[key];
                }
            },
            getValue: function(key) {
                var _this = this;
                return _this[key] || null;
            }
        }
    });

    
</script>

</html>
